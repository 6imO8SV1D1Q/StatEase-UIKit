{
  "id": "sc_06",
  "title": "偏相関係数",
  "subtitle": "偏相関係数の計算",
  "estimated_minutes": 5,
  "category": "scatter_correlation",
  "topic": "散布図と相関",
  "summary": "他の変数の影響を取り除いたうえで2変数の関係を測る偏相関係数の意味と計算方法を解説します。",
  "learning_objectives": [
    "偏相関係数の定義と目的を説明できる",
    "回帰残差や相関行列から偏相関を計算できる",
    "偏相関の解釈と注意点を述べられる"
  ],
  "prerequisites": [],
  "steps": [
    {
      "id": "sc_06_step01",
      "order": 1,
      "type": "text",
      "title": "偏相関とは",
      "body": "",
      "paragraphs": [
        {
          "title": "他変数の影響を除去",
          "body": "偏相関係数は、第三の変数（もしくは複数の変数）を固定した条件で、2つの変数の線形関係を測る指標です。交絡を取り除いた関係を知りたいときに用います。"
        },
        {
          "title": "0〜±1の範囲",
          "body": "通常の相関係数と同じく -1 から 1 の範囲をとりますが、他変数をコントロールした結果、値が大きく変化することがあります。"
        }
      ]
    },
    {
      "id": "sc_06_step02",
      "order": 2,
      "type": "text",
      "title": "計算方法",
      "body": "",
      "paragraphs": [
        {
          "title": "残差を使う方法",
          "body": "X を Z で回帰し残差 \\(e_X\\)、Y を Z で回帰し残差 \\(e_Y\\) を求めます。これらの残差の相関係数が、X と Y の Z をコントロールした偏相関係数になります。"
        },
        {
          "title": "相関行列から求める",
          "body": "3変数の場合、通常の相関係数を用いて \\(r_{XY\\cdot Z} = \\frac{r_{XY} - r_{XZ} r_{YZ}}{\\sqrt{(1 - r_{XZ}^2)(1 - r_{YZ}^2)}}\\) で計算できます。より多変量の場合は相関行列の逆行列から偏相関を求める方法もあります。"
        }
      ]
    },
    {
      "id": "sc_06_step03",
      "order": 3,
      "type": "text",
      "title": "例：広告費・売上・季節",
      "body": "",
      "paragraphs": [
        {
          "title": "通常の相関",
          "body": "広告費と売上の相関が0.85と高いとします。ただし季節指数 Z とそれぞれの相関も高い状況です。"
        },
        {
          "title": "偏相関の計算",
          "body": "季節指数をコントロールした偏相関を求めたところ 0.45 まで低下。季節要因を除くと広告費と売上の関係は中程度であると分かりました。"
        }
      ]
    },
    {
      "id": "sc_06_step04",
      "order": 4,
      "type": "text",
      "title": "注意点",
      "body": "",
      "paragraphs": [
        {
          "title": "仮定する関係",
          "body": "偏相関は線形回帰モデルを前提にしているため、非線形関係や交互作用が強い場合は適切に除去できないことがあります。"
        },
        {
          "title": "複数変数の制御",
          "body": "制御変数を増やすと偏相関の解釈が難しくなります。どの変数をコントロールしたのかを明示し、必要な変数に絞ることが重要です。"
        }
      ]
    }
  ],
  "resources": {
    "key_terms": [
      "偏相関係数",
      "交絡",
      "残差"
    ],
    "external_links": []
  }
}
